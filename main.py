# íŒŒì¼ëª…: safetrip_app_v5.py
import streamlit as st
import random
import pandas as pd

st.set_page_config(
    page_title="SafeTrip: ì—¬í–‰ ì•ˆì „ ë³´ê³ ì„œ (V5)", 
    page_icon="âœˆï¸", 
    layout="wide"
)
st.title("âœˆï¸ SafeTrip: ì—¬í–‰ ì•ˆì „ ë³´ê³ ì„œ ë° ì ê²€ (ìµœì¢…íŒ)")
st.markdown("ì—¬í–‰í•  **êµ­ê°€**ì™€ **ë„ì‹œ**ë¥¼ ì„ íƒí•˜ê³  **'ì•ˆì „ ë³´ê³ ì„œ ê²€ìƒ‰'** ë²„íŠ¼ì„ ëˆŒëŸ¬ ë§ì¶¤í˜• ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.")
st.markdown("---")

# --- 1. ìƒ˜í”Œ ë°ì´í„° í™•ì¥ (ë„ì‹œ ëª©ë¡ ëŒ€í­ ì¶”ê°€) ---
safety_data = {
    # ì•„ì‹œì•„/ì˜¤ì„¸ì•„ë‹ˆì•„ (ì´ 10ê°œêµ­)
    "í•œêµ­": {"ë„ì‹œ": ["ì„œìš¸", "ë¶€ì‚°", "ì œì£¼", "ì¸ì²œ", "ëŒ€êµ¬", "ëŒ€ì „", "ê´‘ì£¼", "ìš¸ì‚°"], "ìœ„í—˜ ì •ë³´": ["ì¹˜ì•ˆ: ëŒ€ì²´ë¡œ ì•ˆì „", "êµí†µ: ì¶œí‡´ê·¼ ì‹œê°„ í˜¼ì¡"], "ëŒ€ì²˜ ìš”ë ¹": ["ëŒ€ì¤‘êµí†µ ì´ìš© ê¶Œì¥"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "112 (ê²½ì°°), 119 (êµ¬ê¸‰/ì†Œë°©)"}},
    "ì¼ë³¸": {"ë„ì‹œ": ["ë„ì¿„", "ì˜¤ì‚¬ì¹´", "í›„ì¿ ì˜¤ì¹´", "ì‚¿í¬ë¡œ", "ë‚˜ê³ ì•¼", "êµí† ", "ìš”ì½”í•˜ë§ˆ"], "ìœ„í—˜ ì •ë³´": ["ìì—°ì¬í•´: ì§€ì§„ ê°€ëŠ¥ì„±", "ì¹˜ì•ˆ: ìœ í¥ê°€ í˜¸ê°í–‰ìœ„ ì£¼ì˜"], "ëŒ€ì²˜ ìš”ë ¹": ["ì§€ì§„ ë°œìƒ ì‹œ 'DROP, COVER, HOLD ON' ê¸°ì–µ"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "110 (ê²½ì°°), 119 (êµ¬ê¸‰/ì†Œë°©)"}},
    "íƒœêµ­": {"ë„ì‹œ": ["ë°©ì½•", "ì¹˜ì•™ë§ˆì´", "í‘¸ì¼“", "íŒŒíƒ€ì•¼", "ë„ë¼ë¹„", "ì½”ì‚¬ë¬´ì´"], "ìœ„í—˜ ì •ë³´": ["ì¹˜ì•ˆ: ê´€ê´‘ì§€ ì†Œë§¤ì¹˜ê¸° ì£¼ì˜", "êµí†µ: íˆ­íˆ­ ì´ìš© ì‹œ ê°€ê²© í¥ì • í•„ìˆ˜"], "ëŒ€ì²˜ ìš”ë ¹": ["ì •ë¶€ ê³µì¸ëœ íƒì‹œ ì•± ì‚¬ìš©"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "191 (ê²½ì°°), 1669 (ì•°ë·¸ëŸ°ìŠ¤)"}},
    "ë² íŠ¸ë‚¨": {"ë„ì‹œ": ["í•˜ë…¸ì´", "í˜¸ì°Œë¯¼", "ë‹¤ë‚­", "ë‚˜íŠ¸ë‘", "í‘¸ê¾¸ì˜¥", "í˜¸ì´ì•ˆ"], "ìœ„í—˜ ì •ë³´": ["êµí†µ: ì˜¤í† ë°”ì´ êµí†µëŸ‰ ë§¤ìš° ë§ìŒ", "ì¹˜ì•ˆ: í•¸ë“œí° ë‚ ì¹˜ê¸° ì£¼ì˜"], "ëŒ€ì²˜ ìš”ë ¹": ["ê¸¸ê±°ë¦¬ ê±¸ì„ ë•Œ ì†Œì§€í’ˆ ë³´í˜¸ ì² ì €"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "113 (ê²½ì°°), 115 (ì•°ë·¸ëŸ°ìŠ¤)"}},
    "ìº„ë³´ë””ì•„": {"ë„ì‹œ": ["í”„ë†ˆíœ", "ì‹œì— ë¦½", "ì‹œì•„ëˆ„í¬ë¹Œ"], "ìœ„í—˜ ì •ë³´": ["ì¹˜ì•ˆ: ì ˆë„ ë°œìƒ ì¦ê°€", "ì§ˆë³‘: ë…ê¸°ì—´ ëª¨ê¸° ì£¼ì˜"], "ëŒ€ì²˜ ìš”ë ¹": ["ì•¼ê°„ ì™¸ì¶œ ì‹œ íƒì‹œ ì´ìš©"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "117 (ê²½ì°°), 119 (ì•°ë·¸ëŸ°ìŠ¤)"}},
    "í•„ë¦¬í•€": {"ë„ì‹œ": ["ë§ˆë‹ë¼", "ì„¸ë¶€", "ë³´ë¼ì¹´ì´", "íŒ”ë¼ì™„"], "ìœ„í—˜ ì •ë³´": ["ì¹˜ì•ˆ: í…ŒëŸ¬ ìœ„í—˜ ì§€ì—­ ì¡´ì¬", "ìì—°ì¬í•´: íƒœí’/ì§€ì§„/í™”ì‚° í™œë™ ì£¼ì˜"], "ëŒ€ì²˜ ìš”ë ¹": ["ì™¸êµë¶€ ì—¬í–‰ê²½ë³´ í™•ì¸ í•„ìˆ˜"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "911 (ê²½ì°°/êµ¬ê¸‰/ì†Œë°©)"}},
    "ì¸ë„ë„¤ì‹œì•„": {"ë„ì‹œ": ["ìì¹´ë¥´íƒ€", "ë°œë¦¬", "ë¡¬ë³µ", "ìš•ì•¼ì¹´ë¥´íƒ€"], "ìœ„í—˜ ì •ë³´": ["ìì—°ì¬í•´: í™”ì‚° í™œë™ ë° ì“°ë‚˜ë¯¸ ê°€ëŠ¥ì„±", "êµí†µ: ë¬´ë©´í—ˆ ìš´ì „ ìœ„í—˜"], "ëŒ€ì²˜ ìš”ë ¹": ["í˜„ì§€ íƒì‹œ ëŒ€ì‹  ê²€ì¦ëœ êµí†µìˆ˜ë‹¨ ì´ìš©"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "110 (ê²½ì°°), 118 (ì•°ë·¸ëŸ°ìŠ¤)"}},
    "í˜¸ì£¼": {"ë„ì‹œ": ["ì‹œë“œë‹ˆ", "ë©œë²„ë¥¸", "ë¸Œë¦¬ì¦ˆë²ˆ", "í¼ìŠ¤", "ì• ë“¤ë ˆì´ë“œ"], "ìœ„í—˜ ì •ë³´": ["ìì—°ì¬í•´: ì‚°ë¶ˆ ë° í­ìš°", "í™˜ê²½: ë…ì„± ìƒë¬¼ ì£¼ì˜"], "ëŒ€ì²˜ ìš”ë ¹": ["ì—¬í–‰ ì‹œ ì•¼ìƒë™ë¬¼ê³¼ì˜ ì ‘ì´‰ ìì œ"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "000 (ê²½ì°°/êµ¬ê¸‰/ì†Œë°©)"}},
    "ë¯¸êµ­": {"ë„ì‹œ": ["ë‰´ìš•", "LA", "ìƒŒí”„ë€ì‹œìŠ¤ì½”", "ì‹œì¹´ê³ ", "ë§ˆì´ì• ë¯¸", "ë¼ìŠ¤ë² ì´ê±°ìŠ¤", "í•˜ì™€ì´"], "ìœ„í—˜ ì •ë³´": ["ì¹˜ì•ˆ: ë„ì‹¬ ì¼ë¶€ ì§€ì—­ ë²”ì£„ìœ¨ ë†’ìŒ", "ë²•ê·œ: ì´ê¸° ì‚¬ê³  ì£¼ì˜"], "ëŒ€ì²˜ ìš”ë ¹": ["ì•¼ê°„ì—ëŠ” ì¸ì ì´ ë“œë¬¸ ê³³ í”¼í•˜ê¸°"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "911 (ê²½ì°°/êµ¬ê¸‰/ì†Œë°©)"}},
    "í”„ë‘ìŠ¤": {"ë„ì‹œ": ["íŒŒë¦¬", "ë‹ˆìŠ¤", "ë§ˆë¥´ì„¸ìœ ", "ë¦¬ì˜¹"], "ìœ„í—˜ ì •ë³´": ["ì¹˜ì•ˆ: ê´€ê´‘ì§€ ì†Œë§¤ì¹˜ê¸° ì„±í–‰", "ì‹œìœ„: ë…¸ë™ì¡°í•© ë° ì •ì¹˜ì  ì‹œìœ„ ë¹ˆë²ˆ"], "ëŒ€ì²˜ ìš”ë ¹": ["ì‹œìœ„ êµ¬ì—­ íšŒí”¼"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "17 (ê²½ì°°), 15 (ì•°ë·¸ëŸ°ìŠ¤)"}},
    "ì´íƒˆë¦¬ì•„": {"ë„ì‹œ": ["ë¡œë§ˆ", "ë°€ë¼ë…¸", "í”¼ë Œì²´", "ë² ë„¤ì¹˜ì•„", "ë‚˜í´ë¦¬"], "ìœ„í—˜ ì •ë³´": ["ì¹˜ì•ˆ: ì§‘ì‹œ ë° ë‹¤ì¤‘ì‹œì„¤ ì†Œë§¤ì¹˜ê¸° ì£¼ì˜", "í™˜ê²½: ê´€ê´‘ì§€ ì£¼ë³€ ì‚¬ê¸°ê¾¼ ì£¼ì˜"], "ëŒ€ì²˜ ìš”ë ¹": ["ê°€ë°©ì€ ëª¸ ì•ìœ¼ë¡œ ë©”ê¸°"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "112 (ê²½ì°°/êµ¬ê¸‰/ì†Œë°©)"}},
    "ìŠ¤í˜ì¸": {"ë„ì‹œ": ["ë°”ë¥´ì…€ë¡œë‚˜", "ë§ˆë“œë¦¬ë“œ", "ì„¸ë¹„ì•¼", "ë°œë Œì‹œì•„"], "ìœ„í—˜ ì •ë³´": ["ì¹˜ì•ˆ: ë‹¤ë°œì„± ì†Œë§¤ì¹˜ê¸°", "ë²•ê·œ: ê±°ë¦¬ì—ì„œ í¡ì—° ê·œì œ ì—„ê²©"], "ëŒ€ì²˜ ìš”ë ¹": ["ì§€ì •ëœ í¡ì—° êµ¬ì—­ ì´ìš©"], "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "112 (ê²½ì°°/êµ¬ê¸‰/ì†Œë°©)"}},
}

# ì—¬í–‰ ì „ í•„ìˆ˜ ì ê²€ ë¦¬ìŠ¤íŠ¸
check_list = [
    "ì—¬ê¶Œ/ë¹„ì ìœ íš¨ ê¸°ê°„ í™•ì¸",
    "ì—¬í–‰ì ë³´í—˜ ê°€ì… ì™„ë£Œ",
    "í˜„ì§€ ê¸´ê¸‰ ì—°ë½ì²˜ ì €ì¥",
    "ì‹ ìš©ì¹´ë“œ ë¶„ì‹¤ ì‹ ê³ ì²˜ ë©”ëª¨",
    "ì—¬í–‰ì§€ ë‚ ì”¨ ë° ë³µì¥ í™•ì¸",
    "ìƒë¹„ì•½(í•´ì—´ì œ, ì†Œí™”ì œ ë“±) ì¤€ë¹„"
]

# --- 2. ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” ë° ê´€ë¦¬ ---

if "selected_country" not in st.session_state:
    st.session_state.selected_country = "í•œêµ­" 
if "selected_city" not in st.session_state:
    st.session_state.selected_city = "ì„œìš¸"
if "checklist_status" not in st.session_state:
    st.session_state.checklist_status = {item: False for item in check_list}
if "report_searched" not in st.session_state:
    st.session_state.report_searched = False

# --- 3. ì¶”ì²œ ì—¬í–‰ì§€ ì„¹ì…˜ (ë©”ì¸ í™”ë©´) ---
st.subheader("ğŸŒŸ ì¶”ì²œ ì—¬í–‰ì§€ í•«ìŠ¤íŒŸ")
col_rec1, col_rec2, col_rec3 = st.columns(3)

# ì¶”ì²œ ë¡œì§ (ì„ì˜ ì§€ì •)
recommendations = [
    ("ë„ì¿„", "ì¼ë³¸", "ì•ˆì „í•œ ì¹˜ì•ˆ, ì§€ì§„ ëŒ€ë¹„ í•„ìˆ˜!"),
    ("íŒŒë¦¬", "í”„ë‘ìŠ¤", "ì†Œë§¤ì¹˜ê¸° ì£¼ì˜, ë¬¸í™”ì¬ ì¤‘ì‹¬ ê´€ê´‘"),
    ("ë°œë¦¬", "ì¸ë„ë„¤ì‹œì•„", "ìì—°ì¬í•´ ë° êµí†µ í˜¼ì¡ ì£¼ì˜"),
]

for i, (city, country, desc) in enumerate(recommendations):
    col = [col_rec1, col_rec2, col_rec3][i]
    with col:
        st.info(f"**{city} ({country})**", icon="ğŸ“Œ")
        st.caption(desc)
        if st.button(f"'{city}' ì •ë³´ ë°”ë¡œ ë³´ê¸°", key=f"rec_btn_{i}", use_container_width=True):
            st.session_state.selected_country = country
            st.session_state.selected_city = city
            st.session_state.report_searched = True
            st.rerun()

st.markdown("---")

# --- 4. ì‚¬ìš©ì ì…ë ¥ ì„¹ì…˜ (ì„ íƒ í›„ ê²€ìƒ‰ ë°©ì‹) ---

st.subheader("ğŸ“ ì•ˆì „ ë³´ê³ ì„œ ìƒì„±")

col_country, col_city = st.columns(2)

# 1. êµ­ê°€ ì„ íƒ (Change State on Select)
with col_country:
    def update_city_on_country_change():
        # êµ­ê°€ê°€ ë³€ê²½ë  ë•Œ ë„ì‹œ ì„ íƒê°’ì„ ë¦¬ì…‹
        country_key = st.session_state.country_select
        current_cities = safety_data.get(country_key, {}).get("ë„ì‹œ", [])
        if current_cities:
            st.session_state.selected_city = current_cities[0]
        else:
            st.session_state.selected_city = ""
        st.session_state.selected_country = country_key
        st.session_state.report_searched = False # ê²€ìƒ‰ ìƒíƒœ í•´ì œ

    st.selectbox(
        "â‘  ì—¬í–‰í•  êµ­ê°€ ì„ íƒ ğŸŒ", 
        list(safety_data.keys()), 
        index=list(safety_data.keys()).index(st.session_state.selected_country),
        key="country_select",
        on_change=update_city_on_country_change 
    )

# 2. ë„ì‹œ ì„ íƒ (Depend on Country)
with col_city:
    current_cities = safety_data.get(st.session_state.selected_country, {}).get("ë„ì‹œ", [])
    
    # í˜„ì¬ ì„ íƒëœ ë„ì‹œê°€ ëª©ë¡ì— ì—†ê±°ë‚˜ ëª©ë¡ì´ ë¹„ì–´ìˆì„ ê²½ìš° ì²˜ë¦¬
    if st.session_state.selected_city not in current_cities and current_cities:
        st.session_state.selected_city = current_cities[0]
    elif not current_cities:
        st.session_state.selected_city = "ì •ë³´ ì—†ìŒ"

    st.selectbox(
        "â‘¡ ì—¬í–‰í•  ë„ì‹œ ì„ íƒ ğŸ™ï¸",
        current_cities,
        index=current_cities.index(st.session_state.selected_city) if st.session_state.selected_city in current_cities else 0,
        key="city_select",
        on_change=lambda: st.session_state.update(selected_city=st.session_state.city_select, report_searched=False) # ì„ íƒ ì‹œ ê²€ìƒ‰ ìƒíƒœ í•´ì œ
    )

col_btn1, col_btn2 = st.columns([1.5, 3])
with col_btn1:
    if st.button("ì•ˆì „ ë³´ê³ ì„œ ê²€ìƒ‰", type="primary", use_container_width=True):
        st.session_state.report_searched = True
        st.rerun()

st.markdown("---")

# --- 5. ì•ˆì „ ë³´ê³ ì„œ ì„¹ì…˜ (ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ í›„ì—ë§Œ ë‚˜íƒ€ë‚¨) ---

selected_country = st.session_state.selected_country
selected_city = st.session_state.selected_city
country_info = safety_data.get(selected_country)

if st.session_state.report_searched:
    
    if not country_info:
        st.error(f"âŒ **{selected_country}**ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ëª©ë¡ì—ì„œ ë‹¤ë¥¸ êµ­ê°€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.")
        country_info = {"ìœ„í—˜ ì •ë³´": ["ìƒì„¸ ì •ë³´ ì—†ìŒ. ì¼ë°˜ ì•ˆì „ ìˆ˜ì¹™ ì¤€ìˆ˜."], 
                        "ëŒ€ì²˜ ìš”ë ¹": ["ì¼ë°˜ ì•ˆì „ ìˆ˜ì¹™ í™•ì¸."], 
                        "í˜„ì§€ ì—°ë½ì²˜": {"ê¸´ê¸‰ ì „í™”": "í˜„ì§€ ê¸´ê¸‰ ì—°ë½ì²˜ ê²€ìƒ‰ í•„ìš”"}}

    st.header(f"ğŸ” **{selected_city}, {selected_country}** ì•ˆì „ ë³´ê³ ì„œ")
    
    tab1, tab2, tab3, tab4 = st.tabs(["âš ï¸ ìœ„í—˜ ì •ë³´", "âœ… ëŒ€ì²˜ ìš”ë ¹", "ğŸ“ í˜„ì§€ ì—°ë½ì²˜", "ğŸ“ ì—¬í–‰ ì „ ì ê²€"])

    with tab1:
        st.subheader("âš ï¸ ì£¼ìš” ì•ˆì „ ìœ„í—˜ ë° ìœ ì˜ ì‚¬í•­")
        for risk in country_info["ìœ„í—˜ ì •ë³´"]:
            st.warning(f"**{risk}**")
        st.markdown("---")
        # ì‚¬ê³  ì‚¬ë¡€ ëŒ€ì‹  ì•ˆì „í•˜ê²Œ ì •ë³´ë¥¼ ì–»ë„ë¡ ìœ ë„
        st.markdown("#### ğŸ“° **í˜„ì§€ ì•ˆì „ ì´ìŠˆ ê²€ìƒ‰**")
        st.info("ğŸ’¡ ìµœê·¼ ë°œìƒí•œ ì‚¬ê³ ë‚˜ ë‰´ìŠ¤ëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ë™ë©ë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ì„ ì´ìš©í•´ ì§ì ‘ í™•ì¸í•´ ë³´ì„¸ìš”.")
        search_query = f"{selected_country} {selected_city} ìµœê·¼ ì•ˆì „ ì‚¬ê³ "
        st.link_button(
            f"êµ¬ê¸€ì—ì„œ '{selected_city} ì•ˆì „ ì‚¬ê³ ' ê²€ìƒ‰í•˜ê¸°", 
            f"https://www.google.com/search?q={search_query}",
            use_container_width=True
        )
        

    with tab2:
        st.subheader("âœ… ìœ„í—˜ ìƒí™©ë³„ í–‰ë™ ìš”ë ¹")
        for tip in country_info["ëŒ€ì²˜ ìš”ë ¹"]:
            st.success(f"**{tip}**")
        
        st.markdown("---")
        st.markdown("#### ğŸš¨ ì¼ë°˜ ê¸´ê¸‰ ìƒí™© ëŒ€ì²˜ë²•")
        st.markdown("""
        * **ë„ë‚œ/ë¶„ì‹¤:** ì¦‰ì‹œ ê²½ì°° ì‹ ê³  ë° ì˜ì‚¬ê´€ì— ì—°ë½. ì‹ ìš©ì¹´ë“œ ì •ì§€.
        * **ìì—°ì¬í•´:** í˜„ì§€ ì¬ë‚œ ë°©ì†¡ ì²­ì·¨, ëŒ€í”¼ì†Œë¡œ ì´ë™.
        """)
        
    with tab3:
        st.subheader("ğŸ“ í˜„ì§€ í•„ìˆ˜ ë¹„ìƒ ì—°ë½ë§ ë° ë©”ëª¨")
        contact = country_info["í˜„ì§€ ì—°ë½ì²˜"]
        
        st.markdown(f"""
        * **ğŸš¨ í˜„ì§€ ê¸´ê¸‰ ì „í™” (ê²½ì°°/ì†Œë°©/ì•°ë·¸ëŸ°ìŠ¤):** **{contact.get("ê¸´ê¸‰ ì „í™”", "ì •ë³´ ì—†ìŒ")}**
        * **ğŸ‡°ğŸ‡· ì£¼ {selected_country} ëŒ€í•œë¯¼êµ­ ëŒ€ì‚¬ê´€/ì˜ì‚¬ê´€:** (ì™¸êµë¶€ ì‚¬ì´íŠ¸ì—ì„œ ì§ì ‘ ê²€ìƒ‰ í›„ ë©”ëª¨í•˜ì„¸ìš”.)
        """)
        
        # ì‚¬ìš©ìê°€ ì§ì ‘ ì—°ë½ì²˜ë¥¼ ë©”ëª¨í•  ìˆ˜ ìˆëŠ” í…ìŠ¤íŠ¸ ì˜ì—­ ì¶”ê°€
        st.text_area(
            "ëŒ€ì‚¬ê´€/ì˜ì‚¬ê´€ ì—°ë½ì²˜ ë©”ëª¨",
            placeholder="ì˜ˆ: +XX-XXX-XXXX (ì£¼XX ëŒ€ì‚¬ê´€)",
            key="embassy_memo"
        )
        st.info("â˜ï¸ í˜„ì§€ ëŒ€ì‚¬ê´€ ì—°ë½ì²˜ëŠ” [ì™¸êµë¶€ í•´ì™¸ì•ˆì „ì—¬í–‰](https://www.mofa.go.kr/www/index.do) ì‚¬ì´íŠ¸ì—ì„œ **ì§ì ‘ í™•ì¸** í›„ ë©”ëª¨í•´ ë‘ëŠ” ê²ƒì´ ê°€ì¥ ì •í™•í•©ë‹ˆë‹¤.")

    with tab4:
        st.subheader("ğŸ“ ì—¬í–‰ ì „ í•„ìˆ˜ ì ê²€ ëª©ë¡")
        st.markdown("ì•„ë˜ í•­ëª©ì„ ëª¨ë‘ ì™„ë£Œí•˜ì—¬ ì•ˆì „í•œ ì—¬í–‰ì„ ì¤€ë¹„í•˜ì„¸ìš”.")
        
        # ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ë Œë”ë§ ë° ìƒíƒœ ì—…ë°ì´íŠ¸
        new_checklist_status = {}
        for item in check_list:
            is_checked = st.checkbox(item, value=st.session_state.checklist_status[item], key=f"check_{item}_{selected_country}")
            new_checklist_status[item] = is_checked

        st.session_state.checklist_status = new_checklist_status
        
        # ì™„ë£Œ ìƒíƒœ í”¼ë“œë°±
        completed_count = sum(st.session_state.checklist_status.values())
        total_count = len(check_list)
        
        st.markdown(f"---")
        if completed_count == total_count:
            st.balloons()
            st.success("ğŸ‰ **ëª¨ë“  ì ê²€ ì™„ë£Œ! ì•ˆì „í•œ ì—¬í–‰ì´ ë  ê±°ì˜ˆìš”!**")
        else:
            st.warning(f"âš ï¸ **{total_count}ê°œ ì¤‘ {completed_count}ê°œ ì™„ë£Œ.** ë‚¨ì€ í•­ëª©ì„ ë§ˆì € ì ê²€í•˜ì„¸ìš”!")

# --- 6. ë§ˆë¬´ë¦¬ ë° ì´ˆê¸°í™” ë²„íŠ¼ ìˆ˜ì • ---
st.markdown("---")
col_reset, col_guide = st.columns([1, 4])

with col_reset:
    # --- ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™” ë²„íŠ¼ ì˜¤ë¥˜ ìˆ˜ì • ---
    if st.button("ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”", type="secondary", use_container_width=True):
        st.session_state.checklist_status = {item: False for item in check_list}
        st.toast("ì²´í¬ë¦¬ìŠ¤íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", icon="ğŸ”„")
        st.rerun() # ì´ˆê¸°í™” í›„ í™”ë©´ ê°±ì‹ 
        
with col_guide:
    st.markdown("### ğŸ—ºï¸ ì§€ë„ ê¸°ëŠ¥ì— ëŒ€í•˜ì—¬")
    # ì§€ë„ ì‹œê°í™”ê°€ ì–´ë µë‹¤ëŠ” ì ì„ ë‹¤ì‹œ ì•ˆë‚´í•©ë‹ˆë‹¤.
    st.info("ê¸°ìˆ ì ì¸ ì œì•½ìœ¼ë¡œ ì¸í•´ ì‹¤ì‹œê°„ ì§€ë„ëŠ” êµ¬í˜„ì´ ì–´ë µìŠµë‹ˆë‹¤. ëŒ€ì‹ , ì—¬í–‰ì§€ **ê´€ë ¨ ì•ˆì „ ì§€ì¹¨ì„ ì‹œê°í™”í•œ ì´ë¯¸ì§€**ë¥¼ ì›í•˜ì‹œë©´ ìš”ì²­í•´ ì£¼ì„¸ìš”! (ì˜ˆ: )")

st.markdown("---")
st.markdown("Â© 2025 SafeTrip Assistant")
